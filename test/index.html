<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Swimming Fish Scroll Animation</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        margin: 0;
        overflow-x: hidden;
      }

      /* Hero Section - Clean gradient */
      .hero-section {
        position: relative;
        height: 100vh;
        background: linear-gradient(
          to bottom,
          #a8d8ea 0%,
          #7eb8d4 50%,
          #5a9cbd 100%
        );
        overflow: hidden;
      }

      /* Water surface line - REMOVED */
      .water-line {
        display: none;
      }

      /* Remove these - no background water needed */
      .lavender-field {
        display: none;
      }

      .water-reflection {
        display: none;
      }

      .mountains {
        display: none;
      }

      /* Canvas container for fish */
      #canvas-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        pointer-events: none;
        z-index: 10;
      }

      canvas {
        display: block;
      }

      /* Dark underwater section */
      .underwater-section {
        position: relative;
        min-height: 150vh;
        background: linear-gradient(
          to bottom,
          #1a1a2e 0%,
          #0f0f1e 50%,
          #000000 100%
        );
        padding: 100px 50px;
      }

      .underwater-content {
        max-width: 800px;
        margin: 0 auto;
        color: #fff;
        opacity: 0.8;
      }

      .underwater-content h2 {
        font-size: 3em;
        margin-bottom: 30px;
        font-family: Arial, sans-serif;
        color: #6ac5d4;
      }

      .underwater-content p {
        font-size: 1.3em;
        line-height: 1.8;
        margin-bottom: 30px;
        font-family: Arial, sans-serif;
      }

      #loading {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #333;
        font-family: Arial, sans-serif;
        font-size: 24px;
        text-align: center;
        z-index: 100;
        background: rgba(255, 255, 255, 0.9);
        padding: 20px 40px;
        border-radius: 10px;
      }

      #scroll-hint {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        color: #fff;
        font-family: Arial, sans-serif;
        font-size: 18px;
        animation: bounce 2s infinite;
        z-index: 20;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateX(-50%) translateY(0);
        }
        50% {
          transform: translateX(-50%) translateY(-10px);
        }
      }
    </style>
  </head>
  <body>
    <div id="canvas-container"></div>
    <div id="loading">Loading fish model...</div>
    <div id="scroll-hint">‚¨áÔ∏è Scroll to see the fish dive ‚¨áÔ∏è</div>

    <!-- Hero Section -->
    <section class="hero-section">
      <div class="water-line"></div>
    </section>

    <!-- Dark Underwater Section -->
    <section class="underwater-section">
      <div class="underwater-content">
        <h2>üåä Deep Underwater</h2>
        <p>
          The fish has dived into the deep ocean, swimming through the dark
          waters...
        </p>
        <p>
          Watch as it gracefully moves through this mysterious underwater world.
        </p>
        <p>
          The swimming continues with natural body movements and tail motion.
        </p>
        <p>Keep scrolling to see the fish complete its journey...</p>
        <p>Almost there... the fish is heading towards the surface again...</p>
        <p>And finally, it swims off into the distance!</p>
      </div>
    </section>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/objects/Water.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>
    <script>
      gsap.registerPlugin(ScrollTrigger);

      // Scene setup
      const scene = new THREE.Scene();

      const camera = new THREE.PerspectiveCamera(
        75,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
      );

      const renderer = new THREE.WebGLRenderer({
        antialias: true,
        alpha: true,
      });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document
        .getElementById("canvas-container")
        .appendChild(renderer.domElement);

      // Lighting
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
      scene.add(ambientLight);

      const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
      directionalLight.position.set(5, 10, 5);
      scene.add(directionalLight);

      // ===== THREE.JS WATER (Official) =====
      const waterGeometry = new THREE.PlaneGeometry(10000, 10000);

      const water = new THREE.Water(waterGeometry, {
        textureWidth: 512,
        textureHeight: 512,
        waterNormals: new THREE.TextureLoader().load(
          "https://threejs.org/examples/textures/waternormals.jpg",
          function (texture) {
            texture.wrapS = texture.wrapT = THREE.RepeatWrapping;
          }
        ),
        sunDirection: new THREE.Vector3(),
        sunColor: 0xffffff,
        waterColor: 0x001e0f,
        distortionScale: 3.7,
        fog: scene.fog !== undefined,
      });

      water.rotation.x = -Math.PI / 2;
      water.position.y = 0;
      scene.add(water);

      // GLTFLoader
      const loader = new THREE.GLTFLoader();
      let fish;
      let fishContainer; // Container to handle world-space rotation
      let mixer;

      loader.load(
        "./models/fish.glb",
        (gltf) => {
          fish = gltf.scene;

          // Create container for world-space rotations
          fishContainer = new THREE.Object3D();
          scene.add(fishContainer);
          fishContainer.add(fish);

          // Scale
          fish.scale.set(4, 4, 4);

          // Rotate to face right
          fish.rotation.y = Math.PI / 2;

          // Start position - center of hero, ABOVE water
          fishContainer.position.set(0, 2.5, 0); // Higher above water

          // Built-in animations
          if (gltf.animations && gltf.animations.length > 0) {
            mixer = new THREE.AnimationMixer(fish);
            gltf.animations.forEach((clip) => {
              mixer.clipAction(clip).play();
            });
          }

          // === SWIMMING BODY ANIMATION ===
          let body1Bone, body2Bone, body2_001Bone;
          let tailBones = [];

          fish.traverse((child) => {
            if (child.isBone) {
              if (child.name === "body1") body1Bone = child;
              if (child.name === "body2") body2Bone = child;
              if (child.name === "body2001") body2_001Bone = child;

              if (
                child.name.includes("root0") &&
                (child.name === "root005" ||
                  child.name === "root006" ||
                  child.name === "root007" ||
                  child.name === "root011" ||
                  child.name === "root013")
              ) {
                tailBones.push(child);
              }
            }
          });

          // Body swimming animation
          if (body1Bone) {
            gsap.to(body1Bone.rotation, {
              z: "+=0.25",
              duration: 0.5,
              repeat: -1,
              yoyo: true,
              ease: "sine.inOut",
            });
          }

          if (body2Bone) {
            gsap.to(body2Bone.rotation, {
              z: "+=0.3",
              duration: 0.5,
              delay: 0.05,
              repeat: -1,
              yoyo: true,
              ease: "sine.inOut",
            });
          }

          if (body2_001Bone) {
            gsap.to(body2_001Bone.rotation, {
              z: "+=0.35",
              duration: 0.5,
              delay: 0.1,
              repeat: -1,
              yoyo: true,
              ease: "sine.inOut",
            });
          }

          tailBones.forEach((bone, index) => {
            gsap.to(bone.rotation, {
              z: `+=${0.4 + index * 0.1}`,
              duration: 0.5,
              delay: 0.15 + index * 0.03,
              repeat: -1,
              yoyo: true,
              ease: "sine.inOut",
            });
          });

          // === SCROLL-BASED JOURNEY ===
          const tl = gsap.timeline({
            scrollTrigger: {
              trigger: "body",
              start: "top top",
              end: "bottom bottom",
              scrub: 1,
            },
          });

          // Phase 1: Hover above water (0-15% scroll)
          // Fish swims horizontally above water

          // Phase 2: Tilt head down in WORLD SPACE (15-30% scroll)
          // Rotate the CONTAINER, not the fish itself
          tl.to(
            fishContainer.rotation,
            {
              z: -Math.PI / 4, // 45 degrees tilt in world space (like doing a nosedive)
              duration: 0.15,
              ease: "power2.in",
            },
            0.15
          );

          // Phase 3: Dive into water head-first (30-45% scroll)
          tl.to(
            fishContainer.position,
            {
              y: -2.5, // Dive deep underwater
              x: 3, // Move right while diving
              duration: 0.15,
              ease: "power2.inOut",
            },
            0.3
          );

          // Phase 4: Level out underwater (45-55% scroll)
          tl.to(
            fishContainer.rotation,
            {
              z: 0, // Return to horizontal in world space
              duration: 0.1,
              ease: "power2.out",
            },
            0.45
          );

          // Phase 5: Swim horizontally underwater (55-85% scroll)
          tl.to(
            fishContainer.position,
            {
              x: 12, // Swim right
              y: -2, // Stay underwater
              duration: 0.3,
              ease: "none",
            },
            0.55
          );

          // Add gentle swimming wave motion
          tl.to(
            fishContainer.position,
            {
              y: "+=0.5",
              duration: 0.1,
              repeat: 2,
              yoyo: true,
              ease: "sine.inOut",
            },
            0.6
          );

          // Phase 6: Exit right side (85-100% scroll)
          tl.to(
            fishContainer.position,
            {
              x: 18, // Swim off screen right
              duration: 0.15,
              ease: "power2.out",
            },
            0.85
          );

          document.getElementById("loading").style.display = "none";
          console.log("üêü Fish ready! Scroll to begin the journey!");
        },
        (progress) => {
          const percent = Math.round((progress.loaded / progress.total) * 100);
          document.getElementById(
            "loading"
          ).textContent = `Loading... ${percent}%`;
        },
        (error) => {
          console.error("Error:", error);
          document.getElementById("loading").textContent =
            "Error loading model.";
        }
      );

      camera.position.set(0, 0, 8);
      camera.lookAt(0, 0, 0);

      const clock = new THREE.Clock();

      function animate() {
        requestAnimationFrame(animate);

        const delta = clock.getDelta();
        if (mixer) mixer.update(delta);

        // Update water animation
        water.material.uniforms["time"].value += 1.0 / 60.0;

        renderer.render(scene, camera);
      }
      animate();

      // Handle resize
      window.addEventListener("resize", () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });

      // Hide scroll hint after first scroll
      let scrolled = false;
      window.addEventListener("scroll", () => {
        if (!scrolled) {
          document.getElementById("scroll-hint").style.display = "none";
          scrolled = true;
        }
      });
    </script>
  </body>
</html>
